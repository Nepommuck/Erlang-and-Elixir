<div id="page">
    <h2 class="sectionedit1" id="laboratorium_nr_7_-_elixir_phoenix">Laboratorium nr 7 - Elixir Phoenix</h2>
    <div class="level2">
    
    <p>
    <br>
    
    </p>
    <hr>
    
    <p>
    <br>
    
    </p>
    
    </div>
    
    <h4 id="przed_zajeciami_prosze_o">Przed zajęciami proszę o:</h4>
    <div class="level4">
    <ol>
    <li class="level1"><div class="li"> <strong>Nie używamy replita z poprzednich ćwiczeń!</strong> </div>
    </li>
    <li class="level1"><div class="li"> utworzenie konta w serwisie replit: <a href="https://replit.com/" class="urlextern" title="https://replit.com/" rel="ugc nofollow">https://replit.com/</a> (jeśli jeszcze nie mamy)</div>
    </li>
    <li class="level1"><div class="li"> utworzenie w nim nowego Repla dla języka Elixir, nazwanie go w formacie „Imię Nazwisko Elixir lab7” </div>
    </li>
    <li class="level1"><div class="li"> przetestowanie jego działania</div>
    </li>
    <li class="level1"><div class="li"> udostępnienie Repla przez „Private join link” i wpisanie linku do niego w <a href="https://forms.gle/rKNq44eSyMDCqhP8A" class="urlextern" title="https://forms.gle/rKNq44eSyMDCqhP8A" rel="ugc nofollow">https://forms.gle/rKNq44eSyMDCqhP8A</a></div>
    </li>
    </ol>
    
    <p>
    <br>
    
    </p>
    
    </div>
    
    <h4 id="cele_cwiczenia">Cele ćwiczenia</h4>
    <div class="level4">
    <ol>
    <li class="level1"><div class="li"> Zapoznanie się z frameworkiem Phoenix</div>
    </li>
    <li class="level1"><div class="li"> Poznanie mechanizmu LiveView</div>
    </li>
    <li class="level1"><div class="li"> Zbudowanie aplikacji webowej w oparciu o ww. technologie</div>
    </li>
    </ol>
    
    <p>
    <br>
    
    </p>
    
    </div>
    
    <h4 id="przebieg_zajec">Przebieg zajęć</h4>
    <div class="level4">
    
    </div>
    
    <h5 id="konfiguracja_srodowiska">Konfiguracja środowiska</h5>
    <div class="level5">
    
    <p>
    <br>
    
    </p>
    <ol>
    <li class="level1"><div class="li"> Tworzymy nowego replita, z zainstalowanym Elixirem (ale nie Phoenixem).</div>
    </li>
    <li class="level1"><div class="li"> W pliku replit.nix (jest to plik ukryty) dodajemy: <pre class="code">pkgs.sqlite
    pkgs.inotify-tools</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W konsoli wpisujemy <pre class="code">kill 1</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W wyniku uruchomienia tych poleceń środowisko jest modyfikowane i sesja jest resetowana.</div>
    </li>
    <li class="level1"><div class="li"> Instalujemy hex-a <pre class="code">mix local.hex</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Instalujemy Phoenix-a w wersji 1.6.16: <pre class="code">mix archive.install hex phx_new 1.6.16</pre>
    </div>
    </li>
    </ol>
    
    </div>
    
    <h5 id="utworzenie_i_konfiguracja_aplikacji">Utworzenie i konfiguracja aplikacji</h5>
    <div class="level5">
    
    <p>
    <br>
    
    </p>
    <ol>
    <li class="level1"><div class="li"> Tworzymy nową aplikację <code>pollutiondb</code>, wyłączając automatyczne dodanie zależności do Ecto: <pre class="code">mix phx.new pollutiondb --no-ecto</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W katalogu <code>pollutiondb/config</code> w pliku <code>dev.exs</code> zmieniamy linijkę: <pre class="code erlang"><a href="http://erlang.org/doc/man/http.html"><span class="kw5">http</span></a>: <span class="br0">[</span>ip: <span class="br0">{</span><span class="nu0">127</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">1</span><span class="br0">}</span><span class="sy1">,</span> port: <span class="nu0">4000</span><span class="br0">]</span><span class="sy1">,</span></pre>
    
    <p>
     na 
    </p>
    <pre class="code erlang"><a href="http://erlang.org/doc/man/http.html"><span class="kw5">http</span></a>: <span class="br0">[</span>ip: <span class="br0">{</span><span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="br0">}</span><span class="sy1">,</span> port: <span class="nu0">4000</span><span class="br0">]</span><span class="sy1">,</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W katalogu <code>pollutiondb/</code> w pliku <code>mix.exs</code> w sekcji dependencies dodajemy <pre class="code erlang"><span class="br0">{</span>:<span class="me2">ecto_sql</span><span class="sy1">,</span> <span class="st0">"~&gt; 3.0"</span><span class="br0">}</span><span class="sy1">,</span>
    <span class="br0">{</span>:<span class="me2">ecto_sqlite3</span><span class="sy1">,</span> <span class="st0">"~&gt; 0.10"</span><span class="br0">}</span><span class="sy1">,</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Ściągamy zależność za pomocą mix-a (<strong>w katalogu pollutiondb</strong>): <pre class="code">mix deps.get</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W katalogu <code>pollutiondb/config</code> w pliku <code>dev.exs</code> dodajemy linijki: <pre class="code erlang">config :<span class="me2">pollutiondb</span><span class="sy1">,</span> ecto_rep<a href="http://erlang.org/doc/man/os.html"><span class="kw5">os</span></a>: <span class="br0">[</span><span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Repo</span><span class="br0">]</span>
    config :<span class="me2">pollutiondb</span><span class="sy1">,</span> <span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Repo</span><span class="sy1">,</span> database: <span class="st0">"database/pollutiondb.db"</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Tworzymy katalog <code>pollutiondb/database</code> i kopiujemy do niego 3 pliki <code>pollutiondb.db[-shm,-wal]</code> z poprzedniej wersji aplikacji.</div>
    </li>
    <li class="level1"><div class="li"> Tworzymy katalog <code>pollutiondb/priv/repo/migrations</code> i kopiujemy do niego 2 pliki z poprzedniej aplikacji.</div>
    </li>
    <li class="level1"><div class="li"> W katalogu <code>pollutiondb/lib/pollutiondb/</code> w pliku <code>application.ex</code> w sekcji children dodajemy: <pre class="code erlang"><span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Repo</span><span class="sy1">,</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Do tego katalogu kopiujemy pliki <code>reading.ex</code>, <code>repo.ex</code> oraz <code>station.ex</code> z poprzedniej aplikacji.</div>
    </li>
    <li class="level1"><div class="li"> Uruchamiamy serwer Phoenix-a upewniając się, że nie ma błędów: <pre class="code">mix phx.server</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W wyniku wywołania tego polecenia, otworzy się okienko webview. Kopiujemy adres naszej aplikacji i otwieramy ją w osobnej zakładce przeglądarki. Okno webview można zamknąć, ponieważ będzie ono generować niepotrzebnie błędy.</div>
    </li>
    <li class="level1"><div class="li"> Jeśli w wyniku wywołania polecenia <code>mix phx.server</code> otrzymujemy komunikat<pre class="code">Application pollutiondb exited: shutdown</pre>
    
    <p>
     usuwamy pliki z katalogu <code>polutiondb/databse</code> i w konsoli wywołujemy polecenia
    </p>
    <pre class="code">mix ecto.create
    mix ecto.migrate</pre>
    
    <p>
     W wyniku wywołania tych poleceń usunięte jednak zostaną dane w naszej bazie danych.
    </p>
    </div>
    </li>
    </ol>
    
    </div>
    
    <h5 id="tworzenie_i_wyswietlanie_stacji">Tworzenie i wyświetlanie stacji</h5>
    <div class="level5">
    
    <p>
    <br>
    
    </p>
    <ol>
    <li class="level1"><div class="li"> Tworzymy katalog <code>pollutiondb/lib/pollutiondb_web/live</code></div>
    </li>
    <li class="level1"><div class="li"> Tworzymy w katalogu <code>pollutiondb/lib/pollutiondb_web/live</code> plik <code>station_live.ex</code>: <pre class="code erlang">defmodule <span class="re5">PollutiondbWeb</span><span class="sy1">.</span><span class="re5">StationLive</span> do
      use <span class="re5">PollutiondbWeb</span><span class="sy1">,</span> :<span class="me2">live_view</span>
    &nbsp;
      alias <span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Station</span>
    &nbsp;
      def <span class="re3">mount</span><span class="br0">(</span><span class="re5">_params</span><span class="sy1">,</span> <span class="re5">_session</span><span class="sy1">,</span> socket<span class="br0">)</span> do
        socket <span class="sy3">=</span> <span class="re3">assign</span><span class="br0">(</span>socket<span class="sy1">,</span> stations: <span class="re5">Station</span><span class="sy1">.</span><span class="kw3">get</span>A<span class="re3">ll</span><span class="br0">(</span><span class="br0">)</span><span class="sy1">,</span> name: <span class="st0">""</span><span class="sy1">,</span> lat: <span class="st0">""</span><span class="sy1">,</span> lon: <span class="st0">""</span><span class="br0">)</span>
        <span class="br0">{</span>:<span class="me2">ok</span><span class="sy1">,</span> socket<span class="br0">}</span>
      <span class="kw1">end</span>
    &nbsp;
      def <span class="re3">render</span><span class="br0">(</span>assigns<span class="br0">)</span> do
        ~H<span class="st0">""</span><span class="st0">"    
        &lt;table&gt;
          &lt;tr&gt;
            &lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Longitude&lt;/th&gt;&lt;th&gt;Latitude&lt;/th&gt;
          &lt;/tr&gt;
          &lt;%= for station &lt;- @stations do %&gt;
            &lt;tr&gt;
              &lt;td&gt;&lt;%= station.name %&gt;&lt;/td&gt;
              &lt;td&gt;&lt;%= station.lon %&gt;&lt;/td&gt;
              &lt;td&gt;&lt;%= station.lat %&gt;&lt;/td&gt;
            &lt;/tr&gt;
          &lt;% end %&gt;
        &lt;/table&gt;
        "</span><span class="st0">""</span>
      <span class="kw1">end</span>
    <span class="kw1">end</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W pliku pollutiondb/lib/pollutiondb_web/router.ex zmieniamy linijkę: <pre class="code erlang">  <span class="kw3">get</span> <span class="st0">"/"</span><span class="sy1">,</span> <span class="re5">PageController</span><span class="sy1">,</span> :<span class="me2">index</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> na <pre class="code erlang">  live <span class="st0">"/"</span><span class="sy1">,</span> <span class="re5">StationLive</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Sprawdzamy co dzieje się w zakładce, w której uruchomiona jest aplikacja. Jeśli w bazie danych były jakieś stacje, to powinny one wyświetlać się w głównym widoku aplikacji.</div>
    </li>
    <li class="level1"><div class="li"> Zapoznajemy się z dokumentacją mechanizmu <a href="https://hexdocs.pm/phoenix_live_view/0.17.5/assigns-eex.html#content" class="urlextern" title="https://hexdocs.pm/phoenix_live_view/0.17.5/assigns-eex.html#content" rel="ugc nofollow">LiveView</a>.</div>
    </li>
    <li class="level1"><div class="li"> W szablonie (metoda <code>render</code>) przed tabelką ze stacjami dodaj formularz służący do tworzenia nowych stacji: <pre class="code html4strict">Create new station
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/form.html"><span class="kw2">form</span></a> phx-submit<span class="sy0">=</span><span class="st0">"insert"</span>&gt;</span>
      Name: <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"text"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"name"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@<span class="kw3">name</span><span class="br0">}</span> <span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
      Lat: <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"number"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"lat"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@lat<span class="br0">}</span> <span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
      Lon: <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"number"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"lon"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@lon<span class="br0">}</span> <span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"submit"</span> <span class="sy0">/</span>&gt;</span> 
    <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/form.html"><span class="kw2">form</span></a>&gt;</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Dodaj również metodę obsługi dodawania stacji: <pre class="code erlang">  def <span class="re3">handle_event</span><span class="br0">(</span><span class="st0">"insert"</span><span class="sy1">,</span> <span class="co1">%{"name" =&gt; name, "lat" =&gt; lat, "lon" =&gt; lon}, socket) do</span>
        <span class="re5">Station</span><span class="sy1">.</span><span class="re3">add</span><span class="br0">(</span><span class="co1">%Station{name: name, lat: to_float(lat, 0.0), lon: to_float(lon, 0.0)})</span>
        socket <span class="sy3">=</span> <span class="re3">assign</span><span class="br0">(</span>socket<span class="sy1">,</span> stations: <span class="re5">Station</span><span class="sy1">.</span><span class="kw3">get</span>A<span class="re3">ll</span><span class="br0">(</span><span class="br0">)</span><span class="sy1">,</span> name: <span class="me2">name</span><span class="sy1">,</span> lat: <span class="me2">lat</span><span class="sy1">,</span> lon: <span class="me2">lon</span><span class="br0">)</span>
        <span class="br0">{</span>:<span class="me2">noreply</span><span class="sy1">,</span> socket<span class="br0">}</span>
      <span class="kw1">end</span></pre>
    
    <p>
    W powyższym kodzie wykorzystywana jest metoda <code>to_float</code>. Należy ją samemu zaimplementować w taki sposób, aby w przypadku błędu związanego z parsowaniem przekazanej wartości, zwracana była druga wartość (wartość domyślna).
    </p>
    </div>
    </li>
    <li class="level1"><div class="li"> Zweryfikuj poprawność działania formularza, dodając kilka nowych stacji do bazy.</div>
    </li>
    <li class="level1"><div class="li"> W szablonie dodaj osobny formularz do wyszukiwania stacji według ich nazwy. Mechanizm ten powinien działać dla zdarzenia <code>phx-change</code>, a nie <code>phx-submit</code>, jak w przypadku poprzedniej akcji. Formularz powinien posiadać jedno pole tekstowe o nazwie <code>query</code>.</div>
    </li>
    <li class="level1"><div class="li"> Dodaj akcję obsługującą zderzenie zmiany formularza. Jeśli wartość zapytania jest pusta, to powinny być wyświetlane wszystkie stacje. Jeśli jest niepusta, to powinna być wyświetlana stacja o wskazanej nazwie. Wykorzystaj kod w module <code>Station</code>, który był napisany na poprzednich zajęciach.</div>
    </li>
    </ol>
    
    </div>
    
    <h5 id="wyszukiwanie_stacji_wedlug_pozycji">Wyszukiwanie stacji według pozycji</h5>
    <div class="level5">
    
    <p>
    <br>
    
    </p>
    <ol>
    <li class="level1"><div class="li"> Utwórz nowy moduł <code>PollutiondbWeb.StationRangeLive</code>, który również znajduje się&nbsp;w katalogu <code>live</code>.</div>
    </li>
    <li class="level1"><div class="li"> W pliku <code>router.ex</code> dodaj linijkę:<pre class="code erlang">live <span class="st0">"/range"</span><span class="sy1">,</span> <span class="re5">StationRangeLive</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Dodaj metodę render, która poza tabelką wyświetlającą stacje posiada następujący formularz (wartości minimalne i maksymalne zmień tak, aby pasowały do danych zgromadzonych w bazie):<pre class="code html4strict"><span class="sc2">&lt;<a href="http://december.com/html/4/element/form.html"><span class="kw2">form</span></a> phx-change<span class="sy0">=</span><span class="st0">"update"</span>&gt;</span>
    Lat min
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"range"</span> min<span class="sy0">=</span><span class="st0">"0"</span> max<span class="sy0">=</span><span class="st0">"5"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"lat_min"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@lat_min<span class="br0">}</span><span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
    Lat max 
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"range"</span> min<span class="sy0">=</span><span class="st0">"0"</span> max<span class="sy0">=</span><span class="st0">"5"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"lat_max"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@lat_max<span class="br0">}</span><span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
    Lon min
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"range"</span> min<span class="sy0">=</span><span class="st0">"0"</span> max<span class="sy0">=</span><span class="st0">"5"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"lon_min"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@lon_min<span class="br0">}</span><span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
    Lon max
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/input.html"><span class="kw2">input</span></a> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">"range"</span> min<span class="sy0">=</span><span class="st0">"0"</span> max<span class="sy0">=</span><span class="st0">"5"</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">"lon_max"</span> <span class="kw3">value</span><span class="sy0">=</span><span class="br0">{</span>@lon_max<span class="br0">}</span><span class="sy0">/</span>&gt;&lt;<a href="http://december.com/html/4/element/br.html"><span class="kw2">br</span></a><span class="sy0">/</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/form.html"><span class="kw2">form</span></a>&gt;</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Zdefiniuj metodę <code>mount</code>, która poza ładowaniem wszystkich stacji (pole <code>stations</code>), definiuje domyślne wartości <code>min_lat</code>, <code>max_lat</code>, <code>min_lon</code> oraz <code>max_lon</code>. Bez tych wartości widok nie będzie działał.</div>
    </li>
    <li class="level1"><div class="li"> Sprawdź działanie nowego modułu dodając w ścieżce aplikacji <code>/range</code> np. <a href="https://pm10-db-web-2.apohllo.repl.co/range" class="urlextern" title="https://pm10-db-web-2.apohllo.repl.co/range" rel="ugc nofollow">https://pm10-db-web-2.apohllo.repl.co/range</a></div>
    </li>
    <li class="level1"><div class="li"> Dodaj metodę <code>handle_event</code>, która będzie aktualizowała listę wyświetlanych stacji, zgodnie z wartościami modyfikowanych parametrów. Pamiętaj aby skonwertować dane tekstowe na wartości liczbowe.</div>
    </li>
    <li class="level1"><div class="li"> Manualnie przetestuj działanie nowego modułu. Upewnij się, że po zmianie kilku parametrów pozostałe parametry nie są resetowane do wartości domyślnych.</div>
    </li>
    </ol>
    
    </div>
    
    <h5 id="wyswietlanie_odczytow_ze_stacji">Wyświetlanie odczytów ze stacji</h5>
    <div class="level5">
    
    <p>
    <br>
    
    </p>
    <ol>
    <li class="level1"><div class="li"> Utwórz nowy moduł <code>PollutiondbWeb.ReadingLive</code>, który również znajduje się&nbsp;w katalogu <code>live</code>.</div>
    </li>
    <li class="level1"><div class="li"> Dodaj ścieżkę <code>/readings</code> która wywołuje ten moduł.</div>
    </li>
    <li class="level1"><div class="li"> Zmodyfikuj moduł <code>Pollutiondb.Reading</code> tak, aby zawierał metodę zwracającą 10 ostatnich odczytów, w kolejności od najnowszego. Możesz wykorzystać ten kod:<pre class="code erlang"><span class="re5">Ecto</span><span class="sy1">.</span><span class="re5">Query</span><span class="sy1">.</span><span class="re3">from</span><span class="br0">(</span>r in <span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Reading</span><span class="sy1">,</span>
      limit: <span class="nu0">10</span><span class="sy1">,</span> order_by: <span class="br0">[</span>des<a href="http://erlang.org/doc/man/c.html"><span class="kw5">c</span></a>: <span class="me2">r</span><span class="sy1">.</span><span class="kw3">date</span><span class="sy1">,</span> des<a href="http://erlang.org/doc/man/c.html"><span class="kw5">c</span></a>: <span class="me2">r</span><span class="sy1">.</span><span class="kw3">time</span><span class="br0">]</span><span class="br0">)</span>
      |<span class="sy3">&gt;</span> <span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Repo</span><span class="sy1">.</span><span class="re3">all</span><span class="br0">(</span><span class="br0">)</span>
      |<span class="sy3">&gt;</span> <span class="re5">Pollutiondb</span><span class="sy1">.</span><span class="re5">Repo</span><span class="sy1">.</span><span class="re3">preload</span><span class="br0">(</span>:<span class="me2">station</span><span class="br0">)</span></pre>
    </div>
    </li>
    <li class="level1"><div class="li"> W metodzie render wyświetl odczyty z bazy danych ograniczając je do 10 najnowszych wyników. W widoku powinna pojawiać się nazwa stacji, data i godzina odczytu oraz typ i wartość odczytu.</div>
    </li>
    <li class="level1"><div class="li"> W module <code>Pollutiondb.Reading</code> dodaj metodę pozwalającą na odczyt 10 najnowszych wyników z określonego dnia. Alternatywnie Możesz zmodyfikować istniejącą metodę <code>getByDate</code>, tak by zwracała 10 najnowszych wyników.</div>
    </li>
    <li class="level1"><div class="li"> Dodaj formularz pozwalający na wyszukiwanie 10 najnowszych odczytów z określonej daty. W formularzu powinno być jedno pole pozwalające na wybór daty.  Pamiętaj aby w metodzie <code>mount</code> ustawić wartość <code>date</code>, która będzie wykorzystywana w polu formularza na odpowiednią wartość domyślną - dzień bieżący.</div>
    </li>
    <li class="level1"><div class="li"> Dodaj metodę <code>handle_event</code>, która obsłuży wywołanie związane ze zmianą&nbsp;wartości pola <code>date</code> w formularzu. Jeśli wartość daty będzie pusta, to wyświetl wartość domyślną, czyli 10 najnowszych wyników.</div>
    </li>
    <li class="level1"><div class="li"> Kod konwertujący tekst na datę umieść&nbsp;w metodzie prywatnej <code>to_date</code>. Jeśli parsowanie daty nie powiedzie się, to wyświetl wyniki z dnia bieżącego.</div>
    </li>
    <li class="level1"><div class="li"> Manualnie przetestuj działanie mechanizmu wyszukiwania według daty.</div>
    </li>
    </ol>
    
    </div>
    
    <h5 id="tworzenie_nowych_odczytow">Tworzenie nowych odczytów</h5>
    <div class="level5">
    
    <p>
    <br>
    
    </p>
    <ol>
    <li class="level1"><div class="li"> W tym samym module w szablonie dodaj formularz pozwalający na dodawanie nowych odczytów. Formularz ten powinien zawierać listę rozwijaną wszystkich stacji zgromadzonych w bazie. Konieczne jest ustawienie zmiennej <code>stations</code> w metodzie <code>mount</code> oraz wyświetlenie stacji w szablonie. Możesz wykorzystać następujący kod <abbr title="HyperText Markup Language">HTML</abbr> do obsługi listy rozwijanej:<pre class="code">&lt;select name="station_id"&gt;
      &lt;%= for station &lt;- @stations do %&gt;
        &lt;option label={station.name} value={station.id} selected={station.id == @station_id}/&gt;
      &lt;% end %&gt;
    &lt;/select&gt;</pre>
    </div>
    </li>
    <li class="level1"><div class="li"> Dodaj obsługę mechanizmu tworzącego nowe odczyty. Pamiętaj aby skonwertować wartość odczytu na odpowiedni typ wartości kompatybilny z typem tego pola w bazie danych. Dotyczy to również identyfikatora stacji, która została wybrana na liście rozwijalnej. Datę i czas ustaw według wartości bieżących. Możesz wykorzystać do tego istniejącą metodę w module <code>Pollutiondb.Reading</code>.</div>
    </li>
    <li class="level1"><div class="li"> Metoda <code>insert</code> wymaga jednak, aby przekazać do niej strukturę <code>Pollutiondb.Station</code>. Możesz utworzyć namiastkę tej struktury, ustalając tylko jej identyfikator: <pre class="code">%Station{id: to_int(station_id, 1)}</pre>
    
    <p>
    Metoda <code>to_int</code> konwertuje tekst na wartość liczbową.
    </p>
    </div>
    </li>
    <li class="level1"><div class="li"> Pamiętaj o tym, aby w metodzie <code>mount</code> oraz metodzie <code>handle_event</code> dodać odpowiednie pola, które będą ustawiały wartości domyślne w formularzu tworzenia odczytów (<code>type</code>, <code>value</code>, <code>station_id</code>). Ułatwi to korzystanie z formularza.</div>
    </li>
    <li class="level1"><div class="li"> Przetestuj manualnie działanie utworzonego mechanizmu.</div>
    </li>
    </ol>
    
    </div>
    
    <h4 id="zadanie_domowe">Zadanie domowe</h4>
    <div class="level4">
    <ol>
    <li class="level1"><div class="li"> ostatnie zajęcia - już nie ma zadania ! </div>
    </li>
    </ol>
    
    </div>
    
        
        
                <div class="meta">
                  <div class="user">
                  Zalogowany jako: <bdi>Student </bdi> (<bdi>erlang</bdi>)			  </div>
                  <div class="doc">
                  <bdi>student/erlang/elab7-2023.txt</bdi> · ostatnio zmienione: 2023/06/27 18:10 przez <bdi>apohllo</bdi>			  </div>
                </div>
        
        </div>